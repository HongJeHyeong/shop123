<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="farmENT">
  
  <!-- 낙찰 상품 목록 가져오기 -->
  	<select id="selectProductList" parameterType="hashmap" resultType="farmENTProduct">
  		SELECT 
	  		S.AUCTION_NO AS auctionNo,
	  		A.AUCTION_PRODUCT AS auctionProduct,
	  		A.AUCTION_PRICE AS auctionPrice,
	  		A.AUCTION_END AS auctionEnd 
  		FROM SELL_FORM S
			LEFT JOIN AUCTION A ON (S.AUCTION_NO=A.AUCTION_NO)
		WHERE A.FARM_NO=#{farmNo} 
			
				<if test="type!=null and type.equals('productName')">
					AND A.auction_product like '%'||#{keyWord}||'%'
				</if>
				<if test="type!=null and type.equals('auctionNo')">
					AND A.auction_no like '%'||#{keyWord}||'%'
				</if>
		ORDER BY 4 DESC
  	
  	</select>
  
  <!--낙찰 상품의 총 개수 -->
  	<select id="selectProductTotalCount" parameterType="hashmap" resultType="int">
  		 SELECT 
			COUNT(*)
  		FROM SELL_FORM S
			LEFT JOIN AUCTION A ON (S.AUCTION_NO=A.AUCTION_NO)
		WHERE A.FARM_NO=#{farmNo}
					
				<if test="type!=null and type.equals('productName')">
					AND A.auction_product like '%'||#{keyWord}||'%'
				</if>
				<if test="type!=null and type.equals('auctionNo')">
					AND A.auction_no like '%'||#{keyWord}||'%'
				</if>
  	</select>
  
  <!-- 주문 목록 리스트 -->
  	<select id="selectOrderList" parameterType="hashmap" resultType="farmENTOrder">
  	
  		SELECT BUY_NO AS buyNo,
  			   USER_NO AS userNo,
  			   FARM_NO AS farmNo,
  			   PRODUCT_NAME AS productName,
  			   PRODUCT_COUNT AS productCount,
  			   PAY_AMOUNT AS payAmount,
  			   PURCHASE_DATE AS purchaseDate,
  			   D_NAME AS dName
		FROM PURCHASELIST P
			LEFT JOIN DELIVERY D ON (P.D_CODE=D.D_CODE)
		WHERE FARM_NO=#{farmNo}
		
		<if test="type!=null and type.equals('userNo')">
			AND user_no like '%'||#{keyWord}||'%'
		</if>
		<if test="type!=null and type.equals('productName')">
			AND product_name like '%'||#{keyWord}||'%'
		</if>
		ORDER BY 7 DESC
  	   
  	</select>
  
  <!-- 주문 목록 리스트 개수 -->	
  	<select id="selectOrderListTotalCount" parameterType="hashmap" resultType="int"> 
  		SELECT COUNT(*)
			FROM PURCHASELIST
			WHERE FARM_NO=#{farmNo}
  		
  		<if test="type!=null and type.equals('userNo')">
			AND user_no like '%'||#{keyWord}||'%'
		</if>
		<if test="type!=null and type.equals('productName')">
			AND product_name like '%'||#{keyWord}||'%'
		
		</if>
  	</select>	
  	
  	
  <!--주문목록,환불접수 회원 정보 가져오기 -->	
  	
  	<select id="selectOneMember" parameterType="int" resultType="member">
  		SELECT user_no AS userNo,
  			   user_id AS userId,
  			   user_Pwd AS userPwd,
  			   user_Name AS userName,
  			   user_Nick AS userNick,
  			   user_Email AS userEmail,
  			   user_Phone AS userPhone,
  			   user_Address_Main AS userAddressMain,
  			   user_Address_Sub AS userAddressSub,
  			   user_EnrollDate AS userEnrollDate,
  			   user_End_YN AS userEndYN,
  			   rating AS rating
  			   
			FROM MEMBER
		WHERE USER_NO=#{_parameter}
  	</select>
  	
  	<!-- 주문목록 상품 정보 가져오기 -->

	<select id="selectOneProduct" parameterType="hashmap" resultType="farmENTProduct">
		 SELECT 
	  		AUCTION_NO AS auctionNo,
	  		AUCTION_PRODUCT AS auctionProduct,
	  		AUCTION_PRICE AS auctionPrice,
	  		AUCTION_END AS auctionEnd 
  		FROM AUCTION 
		WHERE FARM_NO=#{farmNo} AND AUCTION_PRODUCT=#{productName} 
		
	</select>
  
  <!-- 배송 상태 입력 -->
  	<insert id="insertDeliveryStatus" parameterType="hashmap">
  		INSERT INTO DELIVERY_MANAGEMENT VALUES(DELIVERY_SEQ.NEXTVAL,
  												#{buyNo},
  												#{deliveryCompany},
  												#{sendNo},
  												#{sendDate},
  												'N',
  												#{deliveryStatus})
  	</insert>
  	
  	<!-- 구매 목록 테이블에 배송 값 변경 -->
  	
  	<update id="updatePurchaselist" parameterType="hashmap">
  	
  		UPDATE PURCHASELIST SET D_CODE=#{deliveryStatus} WHERE BUY_NO=#{buyNo}
  	
  	</update>
  	

  	<!-- 입력한 배송 데이터 값 가져오기 -->
  	<select id="selectDeliveryInputData" parameterType="int" resultType="farmENTDeliveryStatus">
  		SELECT 
  			   Delivery_No AS deliveryNo,
  			   buy_No AS buyNo,
  			   delivery_Company AS deliveryCompany,
  			   delivery_Num AS deliveryNum,
  			   delivery_Date AS deliveryDate,
  			   del_YN AS delYN,
  			   delivery_Status AS deliveryStatus
		FROM DELIVERY_MANAGEMENT
		WHERE BUY_NO =#{_parameter}
		ORDER BY 1 DESC
  	</select>
  	
  	
	<!-- 공지사항 리스트 가져오기-->  	

	<select id="selectNoticeList" parameterType="hashmap" resultType="notice">
		SELECT 
				NOTICE_NO AS noticeNo,
				NOTICE_TITLE AS noticeTitle,
				NOTICE_CONTENT AS noticeContent,
				NOTICE_REGDATE AS noticeRegdate,
				FARM_NO AS farmNo,
				NOTICE_COUNT AS noticeCount,
				NOTICE_END_YN AS noticeEndYN,
				NOTICE_CODE AS noticeCode,
				NOTICE_CATEGORY AS noticeCategory
		FROM NOTICE 
		WHERE NOTICE_CODE IN ('A','F') AND NOTICE_END_YN='N' 
		<if test="type!=null and type.equals('subject')">
			AND NOTICE_TITLE like '%'||#{keyWord}||'%'
		</if>
		<if test="type!=null and type.equals('content')">
			AND NOTICE_CONTENT like '%'||#{keyWord}||'%'
		</if>
		ORDER BY 1 DESC
	
	</select>

	<!-- 공지사항 글 총 개수 -->
	<select id="selectNoticeListTotalCount" parameterType="hashmap" resultType="int">
		
		SELECT COUNT(*)
		FROM NOTICE 
		WHERE NOTICE_CODE IN ('A','F') AND NOTICE_END_YN='N'
		<if test="type!=null and type.equals('subject')">
			AND NOTICE_TITLE like '%'||#{keyWord}||'%'
		</if>
		<if test="type!=null and type.equals('content')">
			AND NOTICE_CONTENT like '%'||#{keyWord}||'%'
		</if>
	
	</select>


  	
</mapper>
