<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="admin">
	<insert id="auctionInput" parameterType="auction">
		INSERT INTO AUCTION VALUES(AUCTION_SEQ.NEXTVAL,#{auctionStart},#{auctionEnd},#{auctionProduct},#{auctionPrice},#{auctionCount1},#{farmNo},#{auctionFormNo},#{farmNo2},#{farmNo3},#{auctionCount2},#{auctionCount3},#{auctionEndYN})
	</insert>
	<select id="auctionCheck" parameterType="integer" resultType="auction">
		select
			auction_no as auctionNo,
			auction_start as auctionStart,
			auction_end as auctionEnd,
			auction_product as auctionProduct,
			auction_Price as auctionPrice,
			auction_Count1 as auctionCount1,
			farm_No as farmNo,
			auction_Form_No as auctionFormNo,
			farm_No2 as farmNo2,
			farm_No3 as farmNo3,
			auction_Count2 as auctionCount2,
			auction_Count3 as auctionCount3,
			auction_EndYN as auctionEndYN
		from (select row_number() over (order by auction_no desc) as num, auction.* from auction 
		where auction_form_no=#{_parameter} and to_date(auction_end)>=to_date(sysdate))
		where num=1
	</select>
	<select id="BIDScheduler" parameterType="integer" resultType="auction">
		select auction_no as auctionNo,
			auction_start as auctionStart,
			auction_end as auctionEnd,
			auction_product as auctionProduct,
			auction_Price as auctionPrice,
			auction_Count1 as auctionCount1,
			farm_No as farmNo,
			auction_Form_No as auctionFormNo,
			farm_No2 as farmNo2,
			farm_No3 as farmNo3,
			auction_Count2 as auctionCount2,
			auction_Count3 as auctionCount3,
			auction_EndYN as auctionEndYN 
		from (select row_number() over (order by auction_no desc) as num, auction.* from auction 
		where auction_form_no=#{_parameter} and to_date(auction_end) &lt; to_date(sysdate) and auction_endYN='N') 
		where num = 1
	</select>
	<insert id="BIDinsert" parameterType="auction">
		insert into BID values(BID_SEQ.NEXTVAL,#{auctionNo},sysdate,'N')
	</insert>
	<update id="auctionEndYN" parameterType="auction">
		update auction set auction_endyn='Y' where auction_no=#{auctionNo}
	</update>
</mapper>
