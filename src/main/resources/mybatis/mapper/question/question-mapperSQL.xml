<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
	<mapper namespace="qUser">
		
		<!-- 사용자 문의 1:1리스트 -->
		<select id="selectUserQuestionList" parameterType="qUser" resultType="qUser">
			select
				QUESTION_USER_NO as QuestionUserNo,
				QUESTION_USER_TITLE as QuestionUserTitle,
				QUESTION_USER_CONTENT as QuestionUserContent,
				QUESTION_USER_REGDATE as QuestionUserRegdate,
				USER_NO as UserNo,
				QUESTION_USER_END_YN as QuestionUserEndYN,
				QUESTIONPHOTO_NO as QuestionPhotoNo,
				QUESTION_USER_CODE as QuestionUserCode,
				QUESTION_USER_CLASSIFY as QuestionUserClassify,
				FARM_NO as FarmNo,
				ORDER_NO as OrderNo,
				QUESTION_USER_ANSWER_YN as QuestionUserAnswer
			from (select row_number() over(order by Question_user_no desc)as num, question_user.* ,user_nick
				from question_user 
				left join member on (question_user.user_no=member.user_no) 
				where QUESTION_USER_END_YN='N')
		</select>		
		
		<!-- 1:1문의 사용자 글 쓰기 -->
		<insert id="insertUserWrite" parameterType="qUser">
			INSERT INTO             QUESTION_USER
			VALUES                  (QUESTION_USER_Seq.nextval,
			                        #{questionUserTitle},
			                        #{questionUserContent},
			                        sysdate,
			                        #{userNo},
			                        'N',
			                        #{questionphotoNo},
			                        #{questionUserCode},
			                        #{questionUserClassify},
			                        #{farmNo},
			                        #{orderNo},
			                        'N')
		</insert>
		
		<!-- 1:1문의 사용자 파일 업로드 선행 -->
		<insert id="insertWriteFile" parameterType="qPhoto">
			<selectKey keyProperty="questionPhotoNo" resultType="integer" order="AFTER">
                SELECT QUESTIONPHOTO_NO FROM QuestionPhoto WHERE QUESTIONPHOTO_UPDATETIME=#{questionPhotoUpdateTime}
            </selectKey>
				insert into 	QuestionPhoto
				values			(QUESTIONPHOTO_SEQ.nextval,
								#{questionPhotoOriginal},
								#{questionPhotoChange},
								#{questionPhotoFilePath},
								#{questionPhotoFileSize},
								#{questionPhotoUpdateTime},
								'N',
								'N')
		</insert>
		
		<update id="updateQPhote" parameterType="integer">
			update QuestionPhoto set questionPhoto_Use_YN='Y' where QUESTIONPHOTO_NO=#{_parameter}
		</update>
	</mapper>


